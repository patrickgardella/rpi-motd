#!/bin/bash
#
# Top part of header with system information
# version 1.00
# anita2R May 2015
# ******************************************************************************
#   This file can be edited - the 'do not edit' message will appear at the top
#              of the output file '/etc/update-motd.d/00-header'
#                         which should not be edited
# ******************************************************************************
# If you run this file directly or through 'run-parts /etc/update-motd-static.d'
#          the output will appear in /etc/update-motd.d/00-header
#                            and not on the screen
# ******************************************************************************
#
# To control message formatting this function centers a piece of text
#  and puts some '#'s around it
centre(){
SP1=$(( (63 - ( ${#1} )) /2 ))
SP2=$SP1
# need an extra space when total length is 1 short (can't have half-spaces on both sides!)
if [[ $(($SP1 + ${#1} + $SP2 )) < 63 ]]; then SP2=$(($SP2+1));fi
# put message together (formatted centred message)
FCM="#"$(printf %"$SP1"s)"$1"$(printf %"$SP2"s)"#"
return 0
}
#
# Get the operating system details from /proc/version
OSD=$(awk '{FS=" \("; $0=$0; print $1}' < /proc/version)
# call function to create formatted message
centre "$OSD"
OSD="$FCM"
#
# Get the first processor information from /proc/cpuinfo
# awk adds line numbers, so we can handle multiple processors and just take info from the first one
PRO=$(grep "model name" < /proc/cpuinfo | awk '{FS=":"; $0=$0; $0=$2;} {FS="\n"; $0=$0; print NR $1;}'| grep "1 ")
# drop the line number we added in awk
PRO=${PRO:2}
# call function to create formatted message
centre "$PRO"
PRO="$FCM"
#
# create machine name including hostname - if set
HNM=$(cat /etc/hostname)
if [ $HNM ]
        then HNM=$(cat /sys/firmware/devicetree/base/model)" - $HNM"
        else HNM=$(cat /sys/firmware/devicetree/base/model)
fi
# call function to create formatted message
centre "$HNM"
HNM="$FCM"
#
# end of pre-processing
#
OUT="/etc/update-motd.d/"$(basename $0)
exec >${OUT}
#
echo "#!/bin/bash"
echo "###########################################"
echo "#         DO NOT EDIT THIS FILE           #"
echo "#        EDIT the 00-header file          #"
echo "# in the /etc/update-motd-static.d folder #"
echo "###########################################"
#
echo "cat << EOF"

echo " #################################################################"
echo " #                                                               #"
echo " $HNM"
echo " #                                                               #"
echo " $PRO"
echo " $OSD"
echo " #                                                               #"

echo "EOF"
